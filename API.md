# Документация API

Это API позволяет управлять расписаниями и чатами для Telegram Cron Reminder.

## Точки доступа (Endpoints)

### Получение расписаний

* **URL:** `/schedules`
* **Метод:** `GET`
* **Описание:** Возвращает список всех расписаний.
* **Ответ:** JSON массив расписаний
* **Код ответа:** 200
* **Пример ответа:**

```json
[
  {
    "id": 1,
    "cron": "* * * * *",
    "message": "Тестовое сообщение",
    "modifier": "d/1",
    "last_fired": "2025-04-28T12:00:00",
    "chat_id": 1,
    "chat_name": "Мой чат"
  }
]
```

### Создание расписания

* **URL:** `/schedules`
* **Метод:** `POST`
* **Описание:** Создает новое расписание.
* **Тело запроса:**

```json
{
  "cron": "* * * * *",
  "message": "Тестовое сообщение",
  "modifier": "d/1",
  "chat_id": 1
}
```

* **Обязательные поля:**
  - `cron`: Cron-выражение (валидируется)
  - `message`: Текст сообщения
  - `chat_id`: ID чата Telegram
* **Опциональные поля:**
  - `modifier`: Модификатор расписания (d/n или w/n)
* **Коды ответа:**
  - 201: Успешное создание
  - 400: Ошибка валидации
* **Пример ответа:**

```json
{
  "status": "success"
}
```

### Редактирование расписания

* **URL:** `/schedules/{schedule_id}`
* **Метод:** `POST`
* **Описание:** Изменяет существующее расписание.
* **Тело запроса:** Аналогично созданию расписания
* **Коды ответа:**
  - 200: Успешное обновление
  - 400: Ошибка валидации
  - 404: Расписание не найдено

### Просмотр будущих запусков

* **URL:** `/list/{schedule_id}`
* **Метод:** `GET`
* **Описание:** Показывает список следующих запусков расписания
* **Параметры:** Количество запусков определяется переменной окружения `TLCR_LIST_ITEMS`
* **Коды ответа:**
  - 200: Успешно
  - 404: Расписание не найдено

### Создание нескольких расписаний

* **URL:** `/schedules_all`
* **Метод:** `POST`
* **Описание:** Создает несколько расписаний из JSON списка.
* **Тело запроса:**

```json
[
  {
    "cron": "* * * * *",
    "message": "Тестовое сообщение 1",
    "modifier": "d/1",
    "chat_id": 1
  },
  {
    "cron": "0 0 * * *",
    "message": "Тестовое сообщение 2",
    "modifier": "w/2",
    "chat_id": 2
  }
]
```

* **Коды ответа:**
  - 201: Успешное создание
  - 400: Ошибка валидации
* **Пример ответа:**

```json
{
  "status": "success"
}
```

### Удаление расписания

* **URL:** `/schedules/{schedule_id}`
* **Метод:** `DELETE`
* **Описание:** Удаляет расписание.
* **Коды ответа:**
  - 200: Успешное удаление
  - 404: Расписание не найдено
* **Пример ответа:**

```json
{
  "status": "deleted"
}
```

### Альтернативное удаление расписания

* **URL:** `/schedules/{schedule_id}/delete`
* **Метод:** `POST`
* **Описание:** Удаляет расписание (альтернативный метод через POST).
* **Ответ:** Перенаправление на главную страницу

### Управление чатами

#### Получение списка чатов

* **URL:** `/chats`
* **Метод:** `GET`
* **Описание:** Отображает страницу для управления чатами Telegram.

#### Добавление чата

* **URL:** `/chats`
* **Метод:** `POST`
* **Описание:** Добавляет новый чат.
* **Тело запроса (form-data):**
  - `name`: Название чата
  - `chat_id`: ID чата Telegram
* **Ответ:** Перенаправление на /chats

#### Удаление чата

* **URL:** `/chats/delete/{chat_id}`
* **Метод:** `GET`
* **Описание:** Удаляет чат.
* **Коды ответа:**
  - 200: Успешное удаление
  - 500: Ошибка при удалении
* **Ответ:** Перенаправление на /chats

### Экспорт расписаний

* **URL:** `/export`
* **Метод:** `GET`
* **Описание:** Экспортирует все расписания в формате JSON.
* **Ответ:** Загрузка файла schedules_export.json

### Сброс базы данных

* **URL:** `/drop_db`
* **Метод:** `GET`
* **Описание:** Пересоздает базу данных. Внимание: Это удалит все существующие расписания и информацию о получателях уведомлений.
* **Коды ответа:**
  - 200: Успешный сброс
  - 500: Ошибка при сбросе
* **Ответ:** Перенаправление на главную страницу
  