# Telegram Cron Reminder

Этот проект представляет собой простое приложение для отправки напоминаний в Telegram на основе расписания `cron` и дополнительных модификаторов.  Приложение предоставляет веб-интерфейс и REST API для управления расписаниями.

## Возможности

- **Гибкое расписание:** Поддержка `cron` выражений и дополнительных модификаторов для точной настройки времени отправки напоминаний.
- **Модификаторы:** Расширенные модификаторы `d/n` (каждые n дней) и `w/n` (каждые n недель) с поддержкой начальной даты (YYYYMMDD>).
- **Управление чатами:**  Возможность отправлять уведомления в разные чаты Telegram.
- **Веб-интерфейс:** Удобный веб-интерфейс для управления расписаниями, добавления, редактирования и удаления напоминаний, а также управления чатами.
- **Экспорт/импорт расписаний:** Возможность экспорта расписаний в формате JSON.
- **Запуск в Docker:** Поддержка запуска приложения в Docker.

## Установка и запуск

### Зависимости

Управление зависимостями осуществляется с помощью файлов `requirements/*.txt`.  

```bash
pip install -r [requirements/web.txt](requirements/web.txt)
pip install -r [requirements/rund.txt](requirements/rund.txt)
```

Основные зависимости:

- **Flask:**  Фреймворк для веб-приложения.
- **python-dotenv:**  Для загрузки переменных окружения.
- **croniter:**  Для работы с cron выражениями.
- **requests:**  Для отправки HTTP запросов.
- **pytz:**  Для работы с временными зонами.
- **python-dateutil:**  Для работы с датами и временем.

### Локальный запуск

1. Клонируйте репозиторий:

```bash
   git clone https://github.com/vsuh/cron-reminder.git
```

- Создайте виртуальное окружение и установите зависимости:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

- Скопируйте файл [.env.example](env/.env.example) в .env и настройте переменные окружения:

```sh
cp env/.env.example env/.env
# Редактируйте .env с вашими значениями
```

- Запустите веб-приложение:

```sh
./web.sh
```

- Запустите фоновый скрипт в режиме разработки (в отдельном терминале):

```bash
./start_prod.sh
```

- Запуск в Docker

Соберите и запустите Docker контейнеры:

```sh
docker-compose up -d
```

Это запустит веб-приложение на порту 7999 и фоновый скрипт `rund.py`.

## Использование

- Веб-интерфейс

Доступ к веб-интерфейсу осуществляется по адресу http://host:7878 (или по адресу, указанному в .env). Вы можете добавлять, редактировать и удалять расписания, а также управлять чатами Telegram через веб-интерфейс.

## API

Приложение предоставляет REST API для управления расписаниями (см. [API](API.md)).

## Модификаторы

Модификаторы позволяют уточнить время срабатывания cron выражения. Поддерживаются следующие модификаторы:

- d/n: Срабатывает каждые n дней.
- w/n: Срабатывает каждые n недель, начиная с понедельника.
- YYYYMMDD>: Указывает начальную дату для отсчета. Например, 20240301>d/3 будет срабатывать каждые 3 дня, начиная с 1 марта 2024 года.

## Пример импорта данных

Для первоначального заполнения расписаний можно использовать JSON файл, например, [dataschedules.json](static/dataschedules.json):

```sh
curl -X POST -H "Content-Type: application/json;charset=utf-8" --data-binary @dataschedules.json http://host:7878/schedules_all
```

Пример файла .env

```ini
TLCR_TELEGRAM_TOKEN=ваш_токен
TLCR_TELEGRAM_CHAT_ID=ваш_id_чата
TLCR_TZ=Europe/Moscow
TLCR_DB_PATH=settings.db
TLCR_LOGPATH=log
TLCR_LOG_LEVEL=INFO
TLCR_SECRET_KEY=ваш_секретный_ключ
TLCR_LIST_ITEMS=10
TLCR_FLASK_PORT=7999
```
## Скрипты

- **start_rund_service.sh** - для запуска с помощью cron
- **start_web_service.sh** - systemd приложение
- **start.sh** - точка входа для docker контейнера
- **web_prod.sh** - запуск веб-службы скриптом start.sh
- **rund_prod.sh** - запуск службы проверки расписаний скриптом start.sh
- **web.sh** - запуск вебслужбы в режиме отладки
